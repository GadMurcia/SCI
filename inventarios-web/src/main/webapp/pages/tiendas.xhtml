<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="./../WEB-INF/plantillas/pl2.xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:t="http://xmlns.jcp.org/jsf/composite/components">

    <ui:define name="content">
        <h:form id="form">
            <p:dataTable id="empresas" var="emp" value="#{tiendaCtr.empresas}" editable="true" editMode="cell"
                         widgetVar="emps" editInitEvent="dblclick" style="margin-bottom:20px">

                <p:ajax event="cellEdit" listener="#{tiendaCtr.onCellEdit}" update="form0:msgs"/>

                <p:column headerText="Nombre">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{emp.nombre}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText id="modelInput3" value="#{emp.nombre}" style="width:100%"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Dirección">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{emp.direccion}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{emp.direccion}" style="width:100%" label="Name"/>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Propietario">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{tiendaCtr.getNombreususario(emp.propietario)}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu value="#{emp.propietario}" style="width:100%"
                                             converter="omnifaces.SelectItemsConverter">
                                <f:selectItem itemLabel="No Seleccionado" itemValue="#{null}" noSelectionOption="true"/>
                                <f:selectItems value="#{tiendaCtr.dueños}" var="ds"
                                               itemLabel="#{tiendaCtr.getNombreususario(ds)}" itemValue="#{ds}"/>
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:column headerText="Matriz">
                    <p:cellEditor>
                        <f:facet name="output">
                            <h:outputText value="#{emp.matriz.nombre}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:selectOneMenu value="#{emp.matriz}" style="width:100%"
                                             converter="omnifaces.SelectItemsConverter">
                                <f:selectItem itemLabel="Ninguna" itemValue="#{null}"
                                              noSelectionOption="#{!tiendaCtr.admin}"/>
                                <f:selectItems value="#{tiendaCtr.matrices}" var="ts"
                                               itemLabel="#{ts.nombre}" itemValue="#{ts}"/>
                            </p:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>
            </p:dataTable>
            <h:panelGrid columns="1" style="margin: 0 auto">
                <p:commandButton  icon="pi pi-save" 
                                  styleClass="ui-button-outlined ui-button-primary"
                                  value="+" update="h0"
                                  actionListener="#{tiendaCtr.nuevaEmpresa()}"
                                  oncomplete="PF('ntiendaDg').show();"/>
            </h:panelGrid>
        </h:form>

        <p:dialog 
            header="Nueva Tienda" widgetVar="ntiendaDg" 
            modal="true" showEffect="fade" hideEffect="fade" 
            resizable="false" closeOnEscape="true" responsive="true">
            <h:form id="h0"  style="margin: auto" >
                <h:panelGrid columns="1" >
                    <t:tiendas empesa="#{tiendaCtr.nmisc}" 
                               matrices="#{tiendaCtr.matrices}" 
                               usuarios="#{tiendaCtr.dueños}" 
                               editable="#{tiendaCtr.nueva}"
                               isMatriz="#{!tiendaCtr.admin}"/>
                    <h:panelGrid columns="1" style="margin: 0 auto">
                        <p:commandButton  icon="pi pi-save" 
                                          styleClass="ui-button-outlined ui-button-primary"
                                          value="Guardar" update="form"
                                          actionListener="#{tiendaCtr.guardar()}"
                                          oncomplete="PF('ntiendaDg').hide();"/>
                    </h:panelGrid>
                </h:panelGrid>
            </h:form>
        </p:dialog>
    </ui:define>

</ui:composition>
